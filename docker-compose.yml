version: "2"

services:

  front:
    build: ./lab/front
    volumes:
      - "front.certs:/etc/nginx/ssl/"
    ports:
      - "80:80"
      - "443:443"
      - "514:514/udp"
    depends_on:
      - ui
      - api
      - camunda

  api:
    build: ./lab/api
    volumes:
      - "repo.entities:/opt/fmc_entities"
      - "repo.contents:/opt/fmc_repository"
      - "monitoring:/opt/rrd"
      - "change-mgt:/opt/svnroot"
      - "settings:/opt/settings"
      - "license:/opt/ubiqube/lic"
    networks:
      default:
        ipv4_address: 172.20.0.66
    hostname: msa
    ports:
      - "2223:22"
    depends_on:
      - db
      - es
  
  db:
    image: ubiqube/msa2:db-20.0
    volumes:
      - "db:/opt/database/9.3/data/"

  es:
    image: ubiqube/msa2:es-20.0
    volumes:
      - "es:/opt/elasticsearch/data/"
    ports:
      - "9000:9000"
      - "9200:9200"

  ui:
    image: ubiqube/msa2-ui:bc0f0522cb1f8a740f3009336d081fdc0ffbd1da
    environment:
      - FEATURE_ADMIN=true
      - FEATURE_LICENCE=true

  camunda:
    image: camunda/camunda-bpm-platform:7.12.0

  linux_me:
    image: linux:me
    build: ./lab/linux.me
    cap_add:
      - NET_ADMIN
    ports:
      - "2224:22"
    networks:
      default:
        ipv4_address: 172.20.0.101
    hostname: linux_me
  
volumes:
  db:
  es:
  monitoring:
  change-mgt:
  repo.entities:
  repo.contents:
  front.certs:
  settings:
  license:

networks:
  default:
    ipam:
      config:
        - subnet: 172.20.0.0/24
